<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<title>joshua poehls | silent thought</title>

<link rel="canonical" href="http://joshua.poehls.me/1/dotnetmigrations-0.5-now-with-a-bulkload-command">
<link href="/feed.xml" rel="alternate" type="application/atom+xml" title="joshua poehls | silent thought">
<meta name="generator" content="Hugo 0.14" />


<link rel="stylesheet" href="/normalize.css">
<link rel="stylesheet" href="/skeleton.css">
<link rel="stylesheet" href="/styles.css">


<link href='http://fonts.googleapis.com/css?family=Merriweather' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>


<meta name="viewport" content="width=device-width, initial-scale=1">


<link rel="apple-touch-icon" href="/touch-icon-iphone.png" /> 
<link rel="apple-touch-icon" sizes="76x76" href="/touch-icon-ipad.png" /> 
<link rel="apple-touch-icon" sizes="120x120" href="/touch-icon-iphone-retina.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/touch-icon-ipad-retina.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/touch-icon-iphone-retinahd.png">

</head>
<body lang="en-US">

<header id="masthead">
	<div class="container">
		<div class="row">
			<div class="twelve columns">
				<h1>
					<small>I am</small>
					<a href="/">Joshua Poehls</a>.
					<small class="contact-link"><a href="/contact">Say hello</a></small>
					<small class="archives-link"><a href="/archives">Archives</a></small>
					<span class="aka">(not so) silent thoughts</span>
				</h1>
			</div>
		</div>
	</div>
</header>



<div class="container">

	

	<section id="posts">
	<div class="row">
<div class="twelve columns">

<article class="post">
    <header>
        <h1>
            
            <a href="http://joshua.poehls.me/1/dotnetmigrations-0.5-now-with-a-bulkload-command">DotNetMigrations 0.5 now with a BulkLoad command!</a>
            
        </h1>
        <p>
            <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" pubdate="pubdate">Mon, Jan 1, 0001</time>
            <span class="symbol">&#8226;</span>
            <a class="permalink" title="Permalink" href="http://joshua.poehls.me/1/dotnetmigrations-0.5-now-with-a-bulkload-command">
                <span class="noprint symbol">&#8734;</span>
                <span class="printonly">http://joshua.poehls.me/1/dotnetmigrations-0.5-now-with-a-bulkload-command</span>
            </a>
        </p>
    </header>

    <p>I just published <a href="http://www.codeplex.com/dotnetmigrations">DotNetMigrations release 0.5 on CodePlex</a>.</p>  <p>This release has several bug fixes, as well as a large amount of code refactoring and a new <b>bulkload</b> command.</p>  <p>I definitely recommend updating to this new version; there are <i>no breaking changes</i>.</p>  <h2>What is a ‘bulkload’ command?</h2>  <p>Well, the theory is simple. We need a way to easily INSERT a bunch of data into multiple tables in a database. Why not use SQL? Simple. Manually typing a hundred SQL INSERT statements is painful, very painful.</p>  <p>First, I’ll show you <i>how</i> this works and then I’ll tell you why I added this command (if you haven’t figured it out by then).</p>  <h2>The <i>How</i></h2>  <p><b></b></p>  <p>Create an XML file that describes the data you want to INSERT into your database. Example: say our database has 2 tables, “States” and “Cities”, here’s is what our XML file may look like for inserting some demo data.</p>  <p>[StatesAndCitiesSimple.xml]<a href="http://lh5.ggpht.com/jpoehls/SDRzFmSWMPI/AAAAAAAABuY/xCJy-9KWqaA/s1600-h/WindowClipping%20%282%29%5B7%5D.png">  
<img style="border: 0px none ;" alt="WindowClipping (2)" src="http://lh4.ggpht.com/jpoehls/SDRzGWSWMQI/AAAAAAAABug/FylC-LdsTrU/WindowClipping%20%282%29_thumb%5B5%5D.png?imgmax=800" border="0" height="196" width="390" /></a> </p>  <p>Now, if we run ...</p>  <blockquote>   <p><strong>db bulkload “SERVER=..." C:\StatesAndCitiesSimple.xml</strong></p> </blockquote>  <p><strong>... </strong>it will:</p>  <ol>   <li>insert 2 rows into our [States] table, and</li>    <li>insert 2 rows into our [Cities] table</li> </ol>  <p>Each attribute on the &lt;row /&gt; elements is expected to be the name of a column in the table, and the value that we want to insert into that column.</p>  <p>We could also do more advanced things like this:</p>  <p>[StatesAndCitiesAdvanced.xml]
<a href="http://lh4.ggpht.com/jpoehls/SDRzHWSWMRI/AAAAAAAABuo/hHx_bR-3re4/s1600-h/WindowClipping%20%283%29%5B3%5D.png"><img style="border: 0px none ;" alt="WindowClipping (3)" src="http://lh6.ggpht.com/jpoehls/SDRzH2SWMSI/AAAAAAAABuw/gu32VlaV5GU/WindowClipping%20%283%29_thumb%5B1%5D.png?imgmax=800" border="0" height="139" width="402" /></a> </p>  <p>Now, when we run...</p>  <blockquote>   <p><b>db bulkload “SERVER=..." C:\StatesAndCitiesAdvanced.xml</b></p> </blockquote>  <p><strong>... </strong>it will:</p>  <ol>   <li>confirm that the database’s schema is at version 5, if not then the <strong>bulkload </strong>will not be attempted</li>    <li>truncate the [States] table</li>    <li>SET IDENTITY_INSERT [States] ON</li>    <li>Insert 2 rows into the [States] table</li>    <li>SET IDENTITY_INSERT [States] OFF</li>    <li>DELETE FROM [Cities] WHERE Name = ‘Denver’</li>    <li>Insert 2 rows into [Cities] table</li> </ol>  <p>Of course, all of this is wrapped in a transaction, so if any piece fails then it will all be rolled back leaving your database unharmed.
</p>  <p>Now that you know a little of the <i>how</i>, let me tell you <i>why</i> I added this.</p>  <h2>The <i>Why</i></h2>  <p>It’s pretty common to create a SQL script that inserts test or demo data into your database. You may be doing this using regular SQL scripts right now, but those aren’t very friendly to edit. Not with lots of data. On the other hand, there are <i>lots</i> of XML editors out there that would make editing such a file much more enjoyable. Or better yet, you could generate the XML auto-magically somehow.</p>  <p>This is where <b>bulkload</b> shines. It gives you a simple, clean XML format that you can describe your data in, as well as the ability specify things like:</p>  <ul>   <li>Turning identity_insert on so that you can insert values into SQL Server identity fields </li>    <li>Truncating the table before inserting new rows </li>    <li>Use a filter expression to delete specific rows from the table before inserting new ones </li> </ul>  <p>This also ties into your migrations by providing a way to validate that the schema version is compatible with the data you want to push into it.</p>  <p>This release also adds return codes to <span style="font-weight: bold;">db.exe</span> so that we can tell whether the command was successful or whether an error occurred. This could be useful when scripting db.exe from a bat file.
</p>  <p>What are you still doing here? Go <a href="http://www.codeplex.com/dotnetmigrations">download the new release</a> and starting migrating!</p>

</article>

<div class="fin symbol">&#10687;</div>

</div>
</div>
	</section>

	

</div>

<footer>
<p>Subscribe to the <a href="/feed.xml">feed</a> to stay up-to-date.</p>
<p>Browse the <a href="/archives">archives</a> if you're bored.</p>
<p>&copy;&nbsp;2014-2015&nbsp;Joshua&nbsp;Poehls.</p>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55160531-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>